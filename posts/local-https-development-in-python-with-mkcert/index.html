<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="setting https in our local development servers with python and mkcert">
<meta name="viewport" content="width=device-width">
<title>Local HTTPS development in Python with Mkcert | Willy's blog</title>
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/index.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://woile.github.io/posts/local-https-development-in-python-with-mkcert/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Woile">
<link rel="prev" href="../creating-a-small-git-like-cli-with-decli/" title="Tutorial: writing my dreamt cli using decli" type="text/html">
<link rel="next" href="../moving-from-docker-alpine-to-slim/" title="Moving from docker alpine to slim" type="text/html">
<meta property="og:site_name" content="Willy's blog">
<meta property="og:title" content="Local HTTPS development in Python with Mkcert">
<meta property="og:url" content="https://woile.github.io/posts/local-https-development-in-python-with-mkcert/">
<meta property="og:description" content="setting https in our local development servers with python and mkcert">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-01-10T14:30:24-03:00">
<meta property="article:tag" content="web frameworks development security https">
</head>
<body>
    <input id="dark-mode" type="checkbox"><div class="theme">
        <div class="layout">
                <header class="cover"><h3 id="brand"><a href="../../" title="Willy's blog" rel="home">
            <span id="blog-title">Willy's blog</span>
        </a></h3>

    <div>
    <label class="dark-mode-label" for="dark-mode"></label>
    
    </div>


    </header><input id="cool-menu" type="checkbox"><label for="cool-menu" class="cool-menu__label">
        <svg class="cool-menu hover:cool-menu checked:cool-menu" viewbox="0 0 100 100" width="40" height="40" aria-hidden="true"><circle cx="50" cy="50" r="50" fill-opacity="0.5"></circle></svg></label>
        <nav class="menu"><ul>
<li><a href="../../">Home</a></li>
                <li><a href="../../blog/">Blog</a></li>
                <li><a href="../../archive.html">Archives</a></li>
                <li><a href="../../categories/index.html">Tags</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>

    
    
    
    </ul></nav><main id="content" class="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h2 class="p-name entry-title header__title" itemprop="headline name"><a href="." class="u-url hover:header__title__link">Local HTTPS development in Python with Mkcert</a></h2>

        <div class="metadata">
            <span class="byline author vcard p-author h-card">
            <span class="byline-name fn p-name" itemprop="author">
                    Woile
            </span>
            </span>
                | <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/web-frameworks-development-security-https/" rel="tag">#web frameworks development security https</a>
            <span class="dateline">
            <a class="article__meta__link hover:article__meta__link" href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-01-10T14:30:24-03:00" itemprop="datePublished" title="2019-01-10 14:30">2019-01-10 14:30</time></a>
            </span>
                <span class="commentline">            <a href="#disqus_thread" data-disqus-identifier="cache/posts/local-https-development-in-python-with-mkcert.html">Comments</a>


                    | <span class="sourceline"><a class="article__meta__link hover:article__meta__link" href="index.rst">Source</a></span>

        </span>
</div>
        
    </header><section class="e-content entry-content" itemprop="articleBody text"><div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#about-mkcert" id="id5">About mkcert</a></p></li>
<li><p><a class="reference internal" href="#configuring-mkcert" id="id6">Configuring mkcert</a></p></li>
<li>
<p><a class="reference internal" href="#python-frameworks" id="id7">Python frameworks</a></p>
<ul>
<li><p><a class="reference internal" href="#uvicorn-starlette" id="id8">Uvicorn + Starlette</a></p></li>
<li><p><a class="reference internal" href="#django-ssl-server" id="id9">Django SSL Server</a></p></li>
<li><p><a class="reference internal" href="#flask" id="id10">Flask</a></p></li>
<li><p><a class="reference internal" href="#gunicorn" id="id11">Gunicorn</a></p></li>
<li><p><a class="reference internal" href="#uwsgi" id="id12">UWSGI</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#security-concerns" id="id13">Security concerns</a></p></li>
<li><p><a class="reference internal" href="#conclusion" id="id14">Conclusion</a></p></li>
</ul>
</div>
<div class="section" id="about-mkcert">
<h2><a class="toc-backref" href="#id5">About mkcert</a></h2>
<p><a class="reference external" href="https://github.com/FiloSottile/mkcert/">mkcert</a> allows you to have a local
certificate authority (CA).
This means that you can run your development web server using HTTPS.
You'll see the green lock in your browser.</p>
<img src="../../images/local-https-development-in-python-with-mkcert/https.png"><p>You might not need it most of the time, but more and more features require
HTTPS by default in the browser, like web bluetooth, service workers, web authentication
and websockets in some cases where SSL is already enabled.</p>
<!-- TEASER_END -->
</div>
<div class="section" id="configuring-mkcert">
<h2><a class="toc-backref" href="#id6">Configuring mkcert</a></h2>
<p>Install the <a class="reference external" href="https://github.com/FiloSottile/mkcert/#installation">dependencies for your os</a>.
In my case I'm using a Linux Debian based os.</p>
<pre class="code console"><a name="rest_code_f38824a6b4bf47eb87b238c80f331a92-1"></a><span class="go">sudo apt install libnss3-tools</span>
</pre>
<p>Download the binary for your distribution from
<a class="reference external" href="https://github.com/FiloSottile/mkcert/releases">mkcert release page</a></p>
<p>Rename the file to <code>mkcert</code> and give execution permissions</p>
<pre class="code console"><a name="rest_code_7bcd448fc69f4fad8ea5eb0e2304b19f-1"></a><span class="go">chmod +x mkcert</span>
</pre>
<p>Install the certificate authorities (CA) using</p>
<pre class="code console"><a name="rest_code_e340bffb96bc40858d85f88024c46d49-1"></a><span class="go">./mkcert -install</span>
</pre>
<p>Create certificates for the domains you'd like to use</p>
<pre class="code console"><a name="rest_code_8c5e6dc87bb0476b820979c5d3c23730-1"></a><span class="go">./mkcert -cert-file cert.pem -key-file key.pem 0.0.0.0 localhost 127.0.0.1 ::1</span>
</pre>
<p>This will create a <code>cert.pem</code> and a <code>key.pem</code> files in your current directory.
We are gonna use this 2 files along the post.</p>
</div>
<div class="section" id="python-frameworks">
<h2><a class="toc-backref" href="#id7">Python frameworks</a></h2>
<p>Now that we have created the certficates for those domains, we just need to
know how to tell our app to use them.</p>
<p>I'll assume you have a virtualenv already created.</p>
<p>Let's see how to do this in some different python frameworks and tools.</p>
<div class="section" id="uvicorn-starlette">
<h3><a class="toc-backref" href="#id8">Uvicorn + Starlette</a></h3>
<p><strong>Update</strong>: uvicorn now has <a class="reference external" href="https://github.com/encode/uvicorn/pull/294">SSL support</a>.</p>
<p>I've used <a class="reference external" href="https://github.com/encode/starlette">starlette</a>
because it's simpler than writing a uvicorn App, but it's not required.</p>
<p>I guess this should be fairly similar for <a class="reference external" href="https://github.com/tiangolo/fastapi">FastAPI</a>,
<a class="reference external" href="https://github.com/bocadilloproject/bocadillo">Bocadillo</a> and <a class="reference external" href="https://github.com/kennethreitz/responder">Responder</a>.</p>
<p>In your terminal run</p>
<pre class="code console"><a name="rest_code_5e0a536179a6425d9be1355eba52c214-1"></a><span class="go">pip install uvicorn starlette</span>
</pre>
<p>Now create a file <code>star_app.py</code></p>
<pre class="code python"><a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-1"></a><span class="c1"># star_app.py</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-2"></a><span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-3"></a><span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">JSONResponse</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-4"></a><span class="kn">import</span> <span class="nn">uvicorn</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-5"></a><span class="kn">import</span> <span class="nn">ssl</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-6"></a>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-7"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">()</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-8"></a>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-9"></a>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-10"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-11"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">homepage</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-12"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">"hello"</span><span class="p">:</span> <span class="s2">"world"</span><span class="p">})</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-13"></a>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-14"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-15"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-16"></a>        <span class="n">app</span><span class="p">,</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-17"></a>        <span class="n">host</span><span class="o">=</span><span class="s2">"0.0.0.0"</span><span class="p">,</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-18"></a>        <span class="n">port</span><span class="o">=</span><span class="mi">8433</span><span class="p">,</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-19"></a>        <span class="n">ssl_version</span><span class="o">=</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_SSLv23</span><span class="p">,</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-20"></a>        <span class="n">cert_reqs</span><span class="o">=</span><span class="n">ssl</span><span class="o">.</span><span class="n">CERT_OPTIONAL</span><span class="p">,</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-21"></a>        <span class="n">ssl_keyfile</span><span class="o">=</span><span class="s2">"./key.pem"</span><span class="p">,</span>        <span class="c1"># Note that the generated certificates</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-22"></a>        <span class="n">ssl_certfile</span><span class="o">=</span><span class="s2">"./cert.pem"</span><span class="p">,</span>      <span class="c1"># are used here</span>
<a name="rest_code_9e0c2fad10a84f169b227aa4e9ad718e-23"></a>    <span class="p">)</span>
</pre>
<p>And then just run</p>
<pre class="code console"><a name="rest_code_4b59b6ec003a4ed496affc8bb787f854-1"></a><span class="go">python star_app.py</span>
</pre>
<p>Go to <code>https://0.0.0.0:8443</code> in your browser</p>
</div>
<div class="section" id="django-ssl-server">
<h3><a class="toc-backref" href="#id9">Django SSL Server</a></h3>
<p><a class="reference external" href="https://github.com/teddziuba/django-sslserver">django-sslserver</a> is a small library which adds the ability to
run a secure debug server with the certificates we just created.</p>
<pre class="code console"><a name="rest_code_b605264bea5945688964b2da055a49c8-1"></a><span class="go">pip install django-sslserver</span>
</pre>
<p>Update your <code>settings.py</code></p>
<pre class="code python"><a name="rest_code_37c2343b2e124e7ea75d27565da17501-1"></a><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span>
<a name="rest_code_37c2343b2e124e7ea75d27565da17501-2"></a>    <span class="s1">'sslserver'</span><span class="p">,</span>
<a name="rest_code_37c2343b2e124e7ea75d27565da17501-3"></a>    <span class="o">...</span>
<a name="rest_code_37c2343b2e124e7ea75d27565da17501-4"></a><span class="p">)</span>
</pre>
<p>And in your terminal run</p>
<pre class="code console"><a name="rest_code_73f604c17b3645e29dfd08cb4da71da7-1"></a><span class="go">python manage.py runsslserver --certificate cert.pem --key key.pem</span>
</pre>
<div class="section" id="django-extensions">
<h4>Django extensions</h4>
<p>There's another alternative which I haven't tested, but it has a lot of extra functionality,
which I don't need, so I've skipped it.</p>
<p>Feel free to try <a class="reference external" href="https://django-extensions.readthedocs.io/en/latest/runserver_plus.html">django-extensions</a></p>
<p>I guess it would be something like</p>
<pre class="code console"><a name="rest_code_ec843c5b7766453c93ac36ffa953a9c0-1"></a><span class="go">python manage.py runserver_plus --cert-file cert.pem --key-file cert.pem</span>
</pre>
</div>
</div>
<div class="section" id="flask">
<h3><a class="toc-backref" href="#id10">Flask</a></h3>
<p>Install <a class="reference external" href="http://flask.pocoo.org/">flask</a></p>
<pre class="code console"><a name="rest_code_7ac58d46d88147a9b5c0daf5cb219095-1"></a><span class="go">pip install flask</span>
</pre>
<p>Create a file <code>flask_app.py</code></p>
<pre class="code python"><a name="rest_code_510c0919d1104e7cac75041915157131-1"></a><span class="c1"># flask_app.py</span>
<a name="rest_code_510c0919d1104e7cac75041915157131-2"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<a name="rest_code_510c0919d1104e7cac75041915157131-3"></a>
<a name="rest_code_510c0919d1104e7cac75041915157131-4"></a><span class="n">application</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a name="rest_code_510c0919d1104e7cac75041915157131-5"></a>
<a name="rest_code_510c0919d1104e7cac75041915157131-6"></a><span class="nd">@application</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<a name="rest_code_510c0919d1104e7cac75041915157131-7"></a><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
<a name="rest_code_510c0919d1104e7cac75041915157131-8"></a>    <span class="k">return</span> <span class="s2">"&lt;h1 style='color:blue'&gt;Hello There!&lt;/h1&gt;"</span>
<a name="rest_code_510c0919d1104e7cac75041915157131-9"></a>
<a name="rest_code_510c0919d1104e7cac75041915157131-10"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
<a name="rest_code_510c0919d1104e7cac75041915157131-11"></a>    <span class="n">application</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ssl_context</span><span class="o">=</span><span class="p">(</span><span class="s1">'cert.pem'</span><span class="p">,</span> <span class="s1">'key.pem'</span><span class="p">))</span>
</pre>
<p>Run in your terminal</p>
<pre class="code console"><a name="rest_code_1a72eb34de41496aa46a0f7fd8fdeb6f-1"></a><span class="go">python flask_app.py</span>
</pre>
</div>
<div class="section" id="gunicorn">
<h3><a class="toc-backref" href="#id11">Gunicorn</a></h3>
<p>Install <a class="reference external" href="https://gunicorn.org/">gunicorn</a>.</p>
<pre class="code console"><a name="rest_code_f49a7ac077964373917f015f41efc6f3-1"></a><span class="go">pip install gunicorn</span>
</pre>
<p>Let's continue with the previous flask example</p>
<pre class="code console"><a name="rest_code_dd676fd3e7a64813a781623341c48fcb-1"></a><span class="go">gunicorn flask_app:application --keyfile=./key.pem --certfile=./cert.pem</span>
</pre>
</div>
<div class="section" id="uwsgi">
<h3><a class="toc-backref" href="#id12">UWSGI</a></h3>
<p>Install <a class="reference external" href="https://uwsgi-docs.readthedocs.io">uwsgi</a>.</p>
<pre class="code console"><a name="rest_code_098b2725d321493ab1130efe75316c99-1"></a><span class="go">pip install uwsgi</span>
</pre>
<p>Create a file called <code>wsgi.py</code></p>
<pre class="code python"><a name="rest_code_d8612250f5bd4683b1dd4644716185ca-1"></a><span class="c1"># wsgi.py</span>
<a name="rest_code_d8612250f5bd4683b1dd4644716185ca-2"></a><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
<a name="rest_code_d8612250f5bd4683b1dd4644716185ca-3"></a>    <span class="n">start_response</span><span class="p">(</span><span class="s1">'200 OK'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'Content-Type'</span><span class="p">,</span> <span class="s1">'text/html'</span><span class="p">)])</span>
<a name="rest_code_d8612250f5bd4683b1dd4644716185ca-4"></a>    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s2">"Hello World"</span><span class="p">]</span>
</pre>
<p>Run in your terminal</p>
<pre class="code console"><a name="rest_code_950d64eb44084deabce10780431cbd82-1"></a><span class="go">uwsgi -w wsgi --https=0.0.0.0:8443,cert.pem,key.pem</span>
</pre>
<p>Go to <code>https://0.0.0.0:8443</code></p>
</div>
</div>
<div class="section" id="security-concerns">
<h2><a class="toc-backref" href="#id13">Security concerns</a></h2>
<p><strong>DO NOT</strong> use this certificates in production. This is <strong>only</strong> for development. Use <a class="reference external" href="https://letsencrypt.org/">Let's Encrypt</a> instead.</p>
<p>You don't need to commit the generated certificates.
Looks like each machine will have to install mkcert, create and work with its own certificates.</p>
<p>This will only work on your local machine, where the server is running, if you want to access from a mobile device
read <a class="reference external" href="https://github.com/FiloSottile/mkcert#mobile-devices">the docs</a>.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id14">Conclusion</a></h2>
<p>Many times, I've had the need to test something with HTTPS, but it took me a lot of time to do it.
I think <code>mkcert</code> is a really easy to use tool which achieves this smoothly.</p>
<p>Do you have any other (security) concerns? Feedback is appreciated.</p>
<p>If you have drop-in examples for other frameworks or tools I'll update the post.</p>
<p>Thanks for reading and happy coding!</p>
<p>Edit: gunicorn example + uvicorn now supports ssl.</p>
</div>
</div>
    </section><aside class="postpromonav"><nav><div itemprop="keywords" class="tags article__meta">
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/web-frameworks-development-security-https/" rel="tag">#web frameworks development security https</a>
        </div>

            <div class="pager hidden-print pagination">
            <span class="previous">
                <a class="hover:pagination__link" href="../creating-a-small-git-like-cli-with-decli/" rel="prev" title="Tutorial: writing my dreamt cli using decli">Previous post</a>
            </span>
            <span class="next">
                <a class="hover:pagination__link" href="../moving-from-docker-alpine-to-slim/" rel="next" title="Moving from docker alpine to slim">Next post</a>
            </span>
        </div>

    </nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="woile",
            disqus_url="https://woile.github.io/posts/local-https-development-in-python-with-mkcert/",
        disqus_title="Local HTTPS development in Python with Mkcert",
        disqus_identifier="cache/posts/local-https-development-in-python-with-mkcert.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="woile";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></main>
</div>
    </div>
                <script src="../../assets/js/index.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77945905-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
