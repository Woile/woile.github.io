<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Personal blog about software development, travel and sports">
<meta name="viewport" content="width=device-width">
<title>Willy's blog | Willy's blog</title>
<link href="assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://woile.github.io/">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script src="https://use.fontawesome.com/ac3419ca62.js"></script><link rel="prefetch" href="posts/how-to-test-selenium-scrapper/" type="text/html">
</head>
<body class="theme-base-0b">
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>My Personal blog.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="galleries/spain/roca_de_la_sierra/">Roca de la Sierra</a>
        <a class="sidebar-nav-item" href="galleries/portugal/castelo_de_campo_maior/">Castelo de Campo Maior</a>
        <a class="sidebar-nav-item" href="galleries/portugal/porto/">Porto</a>
        <a class="sidebar-nav-item" href="galleries/portugal/cascais/">Cascais</a>
        <a class="sidebar-nav-item" href="galleries/portugal/quinta_de_regaleira/">Quinta de Regaleira</a>
        <a class="sidebar-nav-item" href="galleries/spain/seville/">Sevilla</a>
        <a class="sidebar-nav-item" href="galleries/spain/malaga/">Malaga</a>
        <a class="sidebar-nav-item" href="galleries/spain/nerja/">Nerja</a>
        <a class="sidebar-nav-item" href="galleries/spain/alhambra_granada/">Alhambra y Generalife</a>
        <a class="sidebar-nav-item" href="galleries/spain/valencia/">Valencia</a>
        <a class="sidebar-nav-item" href="galleries/spain/barcelona/sagrada_familia/">Sagrada Familia</a>
        <a class="sidebar-nav-item" href="galleries/spain/barcelona/camp_nou/">Camp Nou</a>
        <a class="sidebar-nav-item" href="galleries/spain/barcelona/cosmocaixa/">Cosmocaixa</a>
        <a class="sidebar-nav-item" href="galleries/spain/barcelona/park_guell/">Park Güell</a>
        <a class="sidebar-nav-item" href="galleries/spain/barcelona/ciudad_gotica_rambla/">Barrio Gótico</a>
        <a class="sidebar-nav-item" href="galleries/spain/barcelona/playa_badalona/">Playa Badalona</a>
        <a class="sidebar-nav-item" href="galleries/spain/santander/">Santander</a>
        <a class="sidebar-nav-item" href="galleries/spain/santillana/">Santillana</a>
        <a class="sidebar-nav-item" href="galleries/spain/madrid/">Madrid</a>
        <a class="sidebar-nav-item" href="galleries/france/paris/">Paris</a>
        <a class="sidebar-nav-item" href="galleries/belgium/brussels/">Bruselas</a>
        <a class="sidebar-nav-item" href="galleries/belgium/brugge/">Brujas</a>
        <a class="sidebar-nav-item" href="galleries/netherlands/rotterdam/">Rotterdam</a>
        <a class="sidebar-nav-item" href="galleries/netherlands/amsterdam/">Amsterdam</a>
        <a class="sidebar-nav-item" href="galleries/germany/hamburg/">Hamburgo</a>
        <a class="sidebar-nav-item" href="galleries/germany/berlin/">Berlin</a>
        <a class="sidebar-nav-item" href="galleries/poland/cracow/">Cracovia</a>
        <a class="sidebar-nav-item" href="galleries/czech/prague/">Praga</a>
        <a class="sidebar-nav-item" href="galleries/hungary/budapest/">Budapest</a>
        <a class="sidebar-nav-item" href="galleries/greece/glyfada/">Glyfada</a>
        <a class="sidebar-nav-item" href="galleries/italy/marina_del_cantone/">Marina Del Cantone</a>
        <a class="sidebar-nav-item" href="galleries/italy/capri/">Capri</a>
        <a class="sidebar-nav-item" href="galleries/italy/rome/">Roma</a>
        <a class="sidebar-nav-item" href="galleries/italy/fermo/">Fermo</a>
        <a class="sidebar-nav-item" href="galleries/italy/milano/">Milan</a>
        <a class="sidebar-nav-item" href="galleries/italy/como/">Como</a>
        <a class="sidebar-nav-item" href="galleries/england/cheltenham/">Cheltenham</a>
        <a class="sidebar-nav-item" href="galleries/england/london/">London</a>
        <a class="sidebar-nav-item" href="galleries/spain/palma_majorca/">Palma de Mallorca</a>
        <a class="sidebar-nav-item" href="galleries/denmark/copenhaguen/">Copenhaguen</a>
        <a class="sidebar-nav-item" href="galleries/brasil/sao_paulo/">Sao Paulo</a>
        <a class="sidebar-nav-item" href="galleries/brasil/rio_de_janeiro/">Rio de Janeiro</a>
        <a class="sidebar-nav-item" href="archive.html">Archive</a>
        <a class="sidebar-nav-item" href="categories/">Tags</a>
        <a class="sidebar-nav-item" href="rss.xml">RSS feed</a>
        <a class="sidebar-nav-item" href="stories/visited-places/">Map</a>
        <a class="sidebar-nav-item" href="stories/who-am-i/">About me</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://woile.github.io/" title="Willy's blog" rel="home">Willy's blog</a>

      <div class="pull-right">

            <a rel="noopener noreferrer" target="_blank" href="https://twitter.com/santiwilly" title="Twitter">
                <i class="fa fa-twitter fa-fw" aria-hidden="true"></i>
            </a>
            <a rel="noopener noreferrer" target="_blank" href="https://github.com/Woile" title="Github">
                <i class="fa fa-github fa-fw" aria-hidden="true"></i>
            </a>
            <a rel="noopener noreferrer" target="_blank" href="https://www.linkedin.com/in/santiago-fraire-63b91226" title="Linkedin">
                <i class="fa fa-linkedin fa-fw" aria-hidden="true"></i>
            </a>
      </div>

    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        

<div class="posts">
    <article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/how-to-test-selenium-scrapper/" class="u-url">How to test Selenium scrapper with Python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Woile</span></p>
            <p class="dateline"><a href="posts/how-to-test-selenium-scrapper/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-09-12T11:38:40-03:00" title="2017-09-12 11:38">2017-09-12 11:38</time></a></p>
                <p class="commentline">
        
    <a href="posts/how-to-test-selenium-scrapper/#disqus_thread" data-disqus-identifier="cache/posts/how-to-test-selenium-scrapper.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>This week I've been writing tests for <a class="reference external" href="https://github.com/discov-r/pyinstamation">a project</a> which is
using Selenium as a scrapper.</p>
<p>As you may know, Selenium is a testing framework, it's intended to be used while writing tests,
not as a web crawler/scrapper.</p>
<p>But you can. Why? Because it runs a browser, and the browser is the real sh*t, so the Javascript
gets executed, and we are happy. There are other solutions like <a class="reference external" href="https://github.com/makinacorpus/spynner">Spynner</a>
or writing the scrapper in pure Javascript, but I felt comfortable using Selenium this way.</p>
<div class="section" id="the-problem">
<h2>The problem</h2>
<p>How do we <strong>test</strong> this scrapper? I want it to have tests, damn!</p>
</div>
<div class="section" id="solution">
<h2>Solution</h2>
<p>Save the static content while running the scrapper, then, serve it with a very small http server
while testing. Yes, it's a bit tedious, but it delivers.</p>
<p>When should you save?</p>
<p>Whenever you need to. This is a good example:</p>
<pre class="code python"><a name="rest_code_cb09c7a18cc049afad02ff1a0c7fadc4-1"></a><span class="n">url</span> <span class="o">=</span> <span class="s1">'https://betterexplained.com/articles/why-do-we-multiply-combinations/'</span>
<a name="rest_code_cb09c7a18cc049afad02ff1a0c7fadc4-2"></a><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<a name="rest_code_cb09c7a18cc049afad02ff1a0c7fadc4-3"></a><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a name="rest_code_cb09c7a18cc049afad02ff1a0c7fadc4-4"></a><span class="n">save_current_state</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">)</span>
</pre>
<p>Can I see the code of <code>save_current_state</code>? Here you go:</p>
<pre class="code python"><a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-1"></a><span class="kn">import</span> <span class="nn">os</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-2"></a><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-3"></a>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-4"></a><span class="n">SAVE_SOURCE</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># disable in production</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-5"></a><span class="n">TEST_LOCATION</span> <span class="o">=</span> <span class="s1">'tests/static'</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-6"></a>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-7"></a>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-8"></a><span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-9"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">SAVE_SOURCE</span><span class="p">:</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-10"></a>        <span class="k">return</span> <span class="bp">None</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-11"></a>    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-12"></a>        <span class="n">location</span> <span class="o">=</span> <span class="n">TEST_LOCATION</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-13"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-14"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'source must be a string'</span><span class="p">)</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-15"></a>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-16"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">'/'</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'.html'</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-17"></a>    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-18"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-19"></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-20"></a>
<a name="rest_code_e3d2aa2944724987bda1655ad21e0a12-21"></a>    <span class="k">return</span> <span class="n">filepath</span>
</pre>
<p>Notice how the url is used as the file name (safely parsed). This helps a lot to match urls.
But of course, a case where something custom is required may happen, so you can tune the server to
fit any case.</p>
<p>And the python server? A minor modification from <a class="reference external" href="https://realpython.com/blog/python/testing-third-party-apis-with-mock-servers/">here</a></p>
<pre class="code python"><a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-1"></a><span class="kn">import</span> <span class="nn">os</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-2"></a><span class="kn">import</span> <span class="nn">socket</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-3"></a><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-4"></a><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-5"></a><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">BaseHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-6"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-7"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-8"></a><span class="n">TEST_LOCATION</span> <span class="o">=</span> <span class="s1">'tests/static'</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-9"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-10"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-11"></a><span class="k">class</span> <span class="nc">MockServerRequestHandler</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-12"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-13"></a>    <span class="k">def</span> <span class="nf">_set_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">'Set-Cookie'</span><span class="p">,</span> <span class="s1">'exampleid=c295IGVsIHVzdWFyaW8gZW5pdG8K'</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">'Content-type'</span><span class="p">,</span> <span class="s1">'text/html'</span><span class="p">)</span>  <span class="c1"># change at will</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-18"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-19"></a>    <span class="nd">@property</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-20"></a>    <span class="k">def</span> <span class="nf">_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-21"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">'/'</span><span class="p">),</span> <span class="n">safe</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-22"></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_LOCATION</span><span class="p">,</span> <span class="s1">'{0}.html'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-23"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-24"></a>    <span class="k">def</span> <span class="nf">_read_from_file_or_404</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-25"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-26"></a>            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-27"></a>        <span class="k">except</span> <span class="n">FileNotFoundError</span><span class="p">:</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-28"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-29"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\n</span><span class="s1">&lt;html&gt;&lt;body&gt;404 Not Found!&lt;/body&gt;&lt;/html&gt;'</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-30"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-31"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-32"></a>            <span class="c1"># needs an extra new line</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-33"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-34"></a>            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-35"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-36"></a>    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_headers</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_read_from_file_or_404</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-39"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-40"></a>    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_headers</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_read_from_file_or_404</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-43"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-44"></a>    <span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-45"></a>        <span class="sd">"""Do not write log messages to std. Disable to see the requests."""</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-46"></a>        <span class="k">return</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-47"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-48"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-49"></a><span class="k">def</span> <span class="nf">get_free_port</span><span class="p">(</span><span class="n">hostname</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-50"></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-51"></a>    <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">hostname</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-52"></a>    <span class="n">address</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-53"></a>    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-54"></a>    <span class="k">return</span> <span class="n">port</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-55"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-56"></a>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-57"></a><span class="k">def</span> <span class="nf">start_mock_server</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-58"></a>    <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-59"></a>        <span class="n">port</span> <span class="o">=</span> <span class="n">get_free_port</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-60"></a>    <span class="n">mock_server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="n">hostname</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">MockServerRequestHandler</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-61"></a>    <span class="n">mock_server_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">mock_server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-62"></a>    <span class="n">mock_server_thread</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-63"></a>    <span class="n">mock_server_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a name="rest_code_c1b9500beeac44d698a11d9abb2c4bf2-64"></a>    <span class="k">return</span> <span class="s1">'{hostname}:{port}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</pre>
<p>And finally the base test from which you will inherit, whenever you need to test the scrapper.</p>
<pre class="code python"><a name="rest_code_38f5cebddd494b11a866d6846346dd75-1"></a><span class="kn">import</span> <span class="nn">unittest</span>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-2"></a><span class="kn">from</span> <span class="nn">my_project</span> <span class="kn">import</span> <span class="n">const</span>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-3"></a><span class="kn">from</span> <span class="nn">tests</span> <span class="kn">import</span> <span class="n">start_mock_server</span>  <span class="c1"># or where you saved it</span>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-4"></a>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-5"></a>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-6"></a><span class="k">class</span> <span class="nc">BaseScrapperTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-7"></a>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-8"></a>    <span class="nd">@classmethod</span>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-9"></a>    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-10"></a>        <span class="n">url</span> <span class="o">=</span> <span class="n">start_mock_server</span><span class="p">()</span>
<a name="rest_code_38f5cebddd494b11a866d6846346dd75-11"></a>        <span class="n">const</span><span class="o">.</span><span class="n">HOSTNAME</span> <span class="o">=</span> <span class="n">url</span>
</pre>
<p>Take a look at that last line, your project must have a central point where the <strong>HOSTNAME</strong> is set.
Before testing, you need to tell to your application to hit your localserver.</p>
</div>
<div class="section" id="final-notes">
<h2>Final notes</h2>
<p>If you find hard to test some scrapper function, try dividing it into smaller functions, and testing
them individually.</p>
<p>If a scrapper function does not include any condition, it's okay to <code>return True</code> at the end,
and assert that boolean. If something fails in the scrapper, we'll get noticied with an exception
and the test will fail.</p>
<p>Try isolating the scrapper as much as possible from the rest of your project, whenever you need
to use selenium, avoid including bussiness logic in it as well, this difficults testing and makes
the code quite confusing.</p>
<p>Regards!</p>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/guide-to-sublime-like-a-normal-person/" class="u-url">Guide to Sublime like a normal person</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Woile</span></p>
            <p class="dateline"><a href="posts/guide-to-sublime-like-a-normal-person/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-06-08T16:46:15-03:00" title="2017-06-08 16:46">2017-06-08 16:46</time></a></p>
                <p class="commentline">
        
    <a href="posts/guide-to-sublime-like-a-normal-person/#disqus_thread" data-disqus-identifier="cache/posts/guide-to-sublime-like-a-normal-person.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>First of all, verify that you have installed the latest version of <a href="https://www.sublimetext.com/3">Sublime Text 3</a>.</p>
<h3>General settings</h3>
<p>Add the following settings in <code>Preferences &gt; Settings &gt; User Tab</code></p>
<pre class="code literal-block"><span></span>"trim_trailing_white_space_on_save": true,
"auto_complete": false,
"translate_tabs_to_spaces": true,
"word_wrap": "false",
</pre>


<p><code>trim_trailing_white_space_on_save</code> deletes the trailing spaces. This is useful to select text
properly and sometimes is required by many languages.</p>
<p><code>auto_complete</code> improves sublime's performance. If the project is huge sublime will get slow while
this feature is on by default, having to look up for everything you write. Autocomplete still will be
 triggered if you press <code>tab</code> while writing.</p>
<p><code>translate_tabs_to_spaces</code> forces to always use spaces when tabbing. This is a personal choice, you can
use either <code>tabs</code> or <code>spaces</code>, but be consistent with the one you or your team use.</p>
<p><code>word_wrap</code> if set to false, helps avoiding problems when using features like multiline select.</p>
<h3>Installing packages</h3>
<p>Install the <a href="https://packagecontrol.io/installation">package control</a> as explained there.</p>
<p>To use it go to <code>Tools &gt; Command Palette</code> or by default the shortcut keys are:</p>
<pre class="code literal-block"><span></span>Linux: `ctrl+shit+P`
Os X: `cmd+shift+p`
</pre>


<p>Finally, the steps to install a new package are:</p>
<ol>
<li>Select the option: <code>Package Control: install package</code>.</li>
<li>Wait until the packages are loaded.</li>
<li>Write the name of the package you want to install.</li>
</ol>
<h3>A talk about linters first</h3>
<p>A <strong>lint tool</strong> performs static analysis of source code and flags patterns that might have errors or
otherwise cause problems for the developer.
In other words, it tells you where you are writing incorrect/badly-formatted code.
A linter is a software, that receives the files to analyze as paramters, and it will
return an output indicating in which lines somethings is weird.</p>
<h3>Sublime Linter</h3>
<p>In my opinion, this is the <strong>most important package</strong> everyone should install, that's why I introduced
linters first. Sublime Linter provides an interface
to communicate with the linters, and the errors will be displayed in the editor in an elegant manner.
This means that Sublime Linter will talk with the linter you have installed in your system globally, and will
 display in the editor the errors reported by the linter.</p>
<p>As the site reads:</p>
<blockquote>
<p>SublimeLinter is a plugin for Sublime Text 3 that provides a framework for linting code. Whatever language
 you code in, SublimeLinter can help you write cleaner, better, more bug-free code. SublimeLinter
 has been designed to provide maximum flexibility and usability for users and maximum simplicity
 for linter authors.</p>
</blockquote>
<p>The concept behind it is very simple:
    1. Install globally in your system a linter for the language of your choice (pep8, eslint, csslint, rubocop, etc).
    2. Install the corresponding sublime linter through the <strong>package control</strong>.</p>
<h4>Useful linters</h4>
<p>Choose the one that suits you more, and install it through the package manager of the corresponding language. Eg: pip for python, gem for ruby, etc.</p>
<table>
<thead><tr>
<th>Language</th>
<th align="center">Linter</th>
<th align="center">Sublime package name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td>python</td>
<td align="center">pep8</td>
<td align="center">SublimeLinter-pep8</td>
<td>tool to check your Python code against some of the style conventions in PEP 8</td>
</tr>
<tr>
<td>python</td>
<td align="center">pep257</td>
<td align="center">SublimeLinter-pep257</td>
<td>static analysis tool for checking compliance with Python docstring conventions</td>
</tr>
<tr>
<td>python</td>
<td align="center">pyflakes</td>
<td align="center">SublimeLinter-pyflakes</td>
<td>checks Python source files for errors</td>
</tr>
<tr>
<td>python</td>
<td align="center">flake8</td>
<td align="center">SublimeLinter-flake8</td>
<td>
<strong>[recommended]</strong> includes lint checks provided by the PyFlakes project, PEP-0008 inspired style checks provided by the PyCodeStyle project, and McCabe complexity checking provided by the McCabe project</td>
</tr>
<tr>
<td>python</td>
<td align="center">mypy</td>
<td align="center">SublimeLinter-contrib-mypy</td>
<td>
<strong>[recommended]</strong> includes static type checker (python 3)</td>
</tr>
<tr>
<td>javascript</td>
<td align="center">jshint</td>
<td align="center">SublimeLinter-jshint</td>
<td>JSHint is a program that flags suspicious usage in programs written in JavaScript</td>
</tr>
<tr>
<td>javascript</td>
<td align="center">eslint</td>
<td align="center">SublimeLinter-eslint</td>
<td>
<strong>[recommended]</strong> tool for identifying and reporting on patterns found in ECMAScript/JavaScript code. In many ways, it is similar to JSLint and JSHint with a few exception</td>
</tr>
<tr>
<td>css</td>
<td align="center">csslint</td>
<td align="center">SublimeLinter-csslint</td>
<td>open source CSS code quality tool</td>
</tr>
<tr>
<td>sass</td>
<td align="center">sass-lint</td>
<td align="center">SublimeLinter-contrib-sass-lint</td>
<td>A Node-only Sass linter for both sass and scss syntax!</td>
</tr>
<tr>
<td>ruby</td>
<td align="center">rubocop</td>
<td align="center">SublimeLinter-rubocop</td>
<td>A Ruby static code analyzer, based on the community Ruby style guide.</td>
</tr>
<tr>
<td>golang</td>
<td align="center">golint</td>
<td align="center">Sublime​Linter-contrib-golint</td>
<td>Golint is a linter for Go source code.</td>
</tr>
</tbody>
</table>
<p>Note: I work with python and javascript so I've marked those which I consider good for those languages.</p>
<p>Let's say we want to lint python files with <code>flake8</code>. The procedure would go like this:</p>
<ol>
<li>Check <code>SublimeLinter</code> is installed first.</li>
<li>Install flake8 globally, in a debian based machine: <code>sudo pip install flake8</code>
</li>
<li>Install the related sublime linter plugin. In this case <a href="https://github.com/SublimeLinter/SublimeLinter-flake8">SublimeLinter-flake8</a>
</li>
<li>That's it, try restarting sublime and everything should be up an running.</li>
</ol>
<p><img alt="" src="images/guide-to-sublime-like-a-normal-person/slinter_diagram.jpg"></p>
<h4>Tips to configure sublime linter</h4>
<ul>
<li>If your sublime linter user settings are empty, copy the default ones, because if you overwrite the default, everytime SL is updated, the settings will be reseted.</li>
<li>After installing a custom language that wraps another language, link it in sublimelinter, so the linter still works. For example, for python/django put in your sublime linter settigns:</li>
</ul>
<pre class="code literal-block"><span></span>"syntax_map": {
    "python (django)": "python",
    "python django": "python"
}
</pre>


<ul>
<li>To change the mark style, open the package control and type <strong>Choose Mark Style</strong>, I like the Squiggly underline.</li>
<li>You can ignore rules, in the settings of the linter inside the sublime linter settings.</li>
<li>If you are using <code>mypy</code> and you want to ignore import hints, add to <code>sublimelinter &gt; user settings &gt; linters</code> the following:</li>
</ul>
<pre class="code literal-block"><span></span>"mypy": {
    "@disable": false,
    "args": [
        "--ignore-missing-imports"
    ],
    "excludes": []
}
</pre>


<h3>Another useful Packages</h3>
<p><code>DockBlockr</code> Helps commenting (go to the web for more information)</p>
<p><code>Colorhighlighter</code> Highlights hexa colors, useful for CSS</p>
<p><code>SidebarEnhancements</code> Allows options as move, copy, remove, etc in the side bar</p>
<p><code>Emmet</code> Write HTML faster, introduces many sweet snippets.</p>
<h3>MUST KNOW SHORTCUTS</h3>
<p>Using this shortcuts will make your life much easier.</p>
<p>Search them in your key bindin settings, and observe the keys.</p>
<p><code>toggle_comment</code> usually <code>Ctrl + /</code>
<img alt="" src="images/guide-to-sublime-like-a-normal-person/toggle_comment.gif"></p>
<p><code>select_lines</code> usualy by pressing <code>Ctrl</code> and click
<img alt="" src="images/guide-to-sublime-like-a-normal-person/select_lines.gif"></p>
<p><code>find_under_expand</code> to filter with case, open the search panel and enable the "Case Sensitive" option.</p>
<p>No image for this sorry.</p>
<h3>RECOMMENDED THEME</h3>
<p><a href="https://github.com/Miw0/SoDaReloaded-Theme">SoDaReloaded-Theme</a></p>
<p>This awesome theme also includes cool icons for every extension, like in the image below.</p>
<p><img alt="" src="https://raw.githubusercontent.com/Miw0/sodareloaded-theme/master/dark/example.png"></p>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/django-polymorphic-integration-with-django-filters/" class="u-url">How to filter Polymorphic Models with Django Filters</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Woile</span></p>
            <p class="dateline"><a href="posts/django-polymorphic-integration-with-django-filters/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-03-02T20:58:22-03:00" title="2017-03-02 20:58">2017-03-02 20:58</time></a></p>
                <p class="commentline">
        
    <a href="posts/django-polymorphic-integration-with-django-filters/#disqus_thread" data-disqus-identifier="cache/posts/django-polymorphic-integration-with-django-filters.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>As the title says, I needed a way to filter my polymorphic models using my already defined
<code>rest_framework.FilterSet</code>, and as I didn't find much resources about it I'm sharing my experience here.</p>
<p>First, let's talk about <code>django-polymorphic</code> and <code>django-filters</code>, what are these libraries for.</p>
<div class="section" id="django-polymorphic">
<h2>Django-polymorphic <a class="footnote-reference" href="posts/django-polymorphic-integration-with-django-filters/#id3" id="id1">[1]</a>
</h2>
<pre class="literal-block">
Simplifies using inherited models in Django projects. When a query is made at the base
model, the inherited model classes are returned.
</pre>
<p>One of the most important things to understand of polymorphic is, that when you ask for the queryset of the parent, every element is represented with its children classes. Let's see this.</p>
<p>I'll use the models examples provided by the <a class="reference external" href="https://django-polymorphic.readthedocs.io/en/stable/">docs</a>.</p>
<pre class="code python"><a name="rest_code_fefc62c54e164975a69d214dc53e0da2-1"></a><span class="kn">from</span> <span class="nn">polymorphic.models</span> <span class="kn">import</span> <span class="n">PolymorphicModel</span>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-2"></a>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-3"></a><span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">PolymorphicModel</span><span class="p">):</span>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-4"></a>    <span class="n">topic</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-5"></a>    <span class="n">start_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-6"></a>    <span class="n">finish_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-7"></a>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-8"></a><span class="k">class</span> <span class="nc">ArtProject</span><span class="p">(</span><span class="n">Project</span><span class="p">):</span>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-9"></a>    <span class="n">artist</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-10"></a>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-11"></a><span class="k">class</span> <span class="nc">ResearchProject</span><span class="p">(</span><span class="n">Project</span><span class="p">):</span>
<a name="rest_code_fefc62c54e164975a69d214dc53e0da2-12"></a>    <span class="n">supervisor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_405998d031ca4f51a0c0d7f692b7c38a-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">Project</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="s2">"Department Party"</span><span class="p">)</span>
<a name="rest_code_405998d031ca4f51a0c0d7f692b7c38a-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">ArtProject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="s2">"Painting with Tim"</span><span class="p">,</span> <span class="n">artist</span><span class="o">=</span><span class="s2">"T. Turner"</span><span class="p">)</span>
<a name="rest_code_405998d031ca4f51a0c0d7f692b7c38a-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">ResearchProject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="s2">"Swallow Aerodynamics"</span><span class="p">,</span> <span class="n">supervisor</span><span class="o">=</span><span class="s2">"Dr. Winter"</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_edb4fddba69147b399a80bbcec9ce549-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">Project</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a name="rest_code_edb4fddba69147b399a80bbcec9ce549-2"></a><span class="p">[</span> <span class="o">&lt;</span><span class="n">Project</span><span class="p">:</span>         <span class="nb">id</span> <span class="mi">1</span><span class="p">,</span> <span class="n">topic</span> <span class="s2">"Department Party"</span><span class="o">&gt;</span><span class="p">,</span>
<a name="rest_code_edb4fddba69147b399a80bbcec9ce549-3"></a>  <span class="o">&lt;</span><span class="n">ArtProject</span><span class="p">:</span>      <span class="nb">id</span> <span class="mi">2</span><span class="p">,</span> <span class="n">topic</span> <span class="s2">"Painting with Tim"</span><span class="p">,</span> <span class="n">artist</span> <span class="s2">"T. Turner"</span><span class="o">&gt;</span><span class="p">,</span>
<a name="rest_code_edb4fddba69147b399a80bbcec9ce549-4"></a>  <span class="o">&lt;</span><span class="n">ResearchProject</span><span class="p">:</span> <span class="nb">id</span> <span class="mi">3</span><span class="p">,</span> <span class="n">topic</span> <span class="s2">"Swallow Aerodynamics"</span><span class="p">,</span> <span class="n">supervisor</span> <span class="s2">"Dr. Winter"</span><span class="o">&gt;</span> <span class="p">]</span>
</pre>
<p>As you can see, this can be really helpful when using Django Rest Framework (DRF) and model inheritance.
It allows to use just one model, in this case <code>Project</code>, in a <code>ModelViewSet</code> and you will receive all the instances for <code>Project</code>, <code>ArtProject</code> and <code>ResearchProject</code>. Take into account
that your serializer will have to handle the representation of each of the models.</p>
</div>
<div class="section" id="django-filter">
<h2>Django-filter <a class="footnote-reference" href="posts/django-polymorphic-integration-with-django-filters/#id4" id="id2">[2]</a>
</h2>
<pre class="literal-block">
Is a generic, reusable application to alleviate writing some of the more mundane bits of view code. Specifically, it allows users to filter down a queryset based on a model’s fields.
</pre>
<p>Fundamentally, when using django filters you'll want to create a class specifying the model's
fields by which a queryset can be filtered.</p>
<p>Let's modified a bit the example of the <a class="reference external" href="https://django-filter.readthedocs.io/en/latest/guide/usage.html">docs</a>:</p>
<pre class="code python"><a name="rest_code_bad88f2c9dee4e18ade9621443d94ac9-1"></a><span class="kn">import</span> <span class="nn">django_filters</span>
<a name="rest_code_bad88f2c9dee4e18ade9621443d94ac9-2"></a>
<a name="rest_code_bad88f2c9dee4e18ade9621443d94ac9-3"></a><span class="k">class</span> <span class="nc">ProjectFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
<a name="rest_code_bad88f2c9dee4e18ade9621443d94ac9-4"></a>    <span class="n">topic</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">(</span><span class="n">lookup_expr</span><span class="o">=</span><span class="s1">'iexact'</span><span class="p">)</span>
<a name="rest_code_bad88f2c9dee4e18ade9621443d94ac9-5"></a>
<a name="rest_code_bad88f2c9dee4e18ade9621443d94ac9-6"></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a name="rest_code_bad88f2c9dee4e18ade9621443d94ac9-7"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">Project</span>
<a name="rest_code_bad88f2c9dee4e18ade9621443d94ac9-8"></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'start_date'</span><span class="p">,</span> <span class="s1">'finish_date'</span><span class="p">]</span>
</pre>
<p>And the view should look something like:</p>
<pre class="code python"><a name="rest_code_00b8b09cde0342999679ffe185bd1944-1"></a><span class="k">def</span> <span class="nf">project_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<a name="rest_code_00b8b09cde0342999679ffe185bd1944-2"></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">ProjectFilter</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Project</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<a name="rest_code_00b8b09cde0342999679ffe185bd1944-3"></a>    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'my_app/template.html'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'filter'</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span>
</pre>
<p>Obviously, this will help reduce the amount of code written, and will be way easier to mantain.
The good thing about this library, and what matters to me the most, is that it has a great <a class="reference external" href="https://django-filter.readthedocs.io/en/latest/guide/rest_framework.html">integration with DRF</a> by providing a DRF-specific FilterSet and a filter backend.</p>
</div>
<div class="section" id="filtering-by-a-polymorphic-model">
<h2>Filtering by a polymorphic model</h2>
<p>As we stated at the beginning what I wanted to do is filter by a <strong>polymorphic model</strong>, because we have different types of projects. This can be easily achieved by reading the docs, no seriously, by essentially using the <code>rest_framework.FilterSet</code> and using a customized filter with <a class="reference external" href="https://django-filter.readthedocs.io/en/latest/guide/usage.html#customize-filtering-with-filter-method">Filter.method</a> in our FilterSet.</p>
<pre class="code python"><a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-1"></a><span class="kn">import</span> <span class="nn">django_filters</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-2"></a>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-3"></a>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-4"></a><span class="k">def</span> <span class="nf">get_subclasses_as_choice</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-5"></a>    <span class="n">choices</span> <span class="o">=</span> <span class="p">{</span><span class="n">subclass</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">subclass</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-6"></a>               <span class="k">for</span> <span class="n">subclass</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()}</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-7"></a>    <span class="k">return</span> <span class="n">choices</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-8"></a>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-9"></a>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-10"></a><span class="k">class</span> <span class="nc">ProjectFilter</span><span class="p">(</span><span class="n">django_filters</span><span class="o">.</span><span class="n">rest_framework</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-11"></a>    <span class="n">project_type</span> <span class="o">=</span> <span class="n">django_filters</span><span class="o">.</span><span class="n">MultipleChoiceFilter</span><span class="p">(</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-12"></a>        <span class="n">method</span><span class="o">=</span><span class="s1">'project_type_filter'</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">get_subclasses_as_choice</span><span class="p">(</span><span class="n">Project</span><span class="p">))</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-13"></a>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-14"></a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-15"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">Project</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-16"></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'topic'</span><span class="p">,</span> <span class="s1">'start_date'</span><span class="p">,</span> <span class="s1">'end_date'</span><span class="p">]</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-17"></a>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-18"></a>    <span class="k">def</span> <span class="nf">project_type_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-19"></a>        <span class="n">project_choices</span> <span class="o">=</span> <span class="n">get_subclasses_as_choice</span><span class="p">(</span><span class="n">Project</span><span class="p">)</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-20"></a>        <span class="n">selected_projects</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">project_choices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-21"></a>                             <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
<a name="rest_code_7c7e86883c0e4f94bc97089e9a876225-22"></a>        <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="o">*</span><span class="n">selected_projects</span><span class="p">)</span>
</pre>
<p>Now, if our querystring includes a key <code>project_type</code>, it will check if the values match any of
the choices and it will return the queryset filtered by the specified choices.
And that's it, we have successfully filtered polymorphic models. Now we just need to add <code>ProjectFilter</code> to the <code>filter_class</code> in the <code>viewsets.ModelViewSet</code>.</p>
<p>Cheers!</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup>
<col class="label">
<col>
</colgroup>
<tbody valign="top"><tr>
<td class="label"><a class="fn-backref" href="posts/django-polymorphic-integration-with-django-filters/#id1">[1]</a></td>
<td><a class="reference external" href="https://github.com/django-polymorphic/django-polymorphic">https://github.com/django-polymorphic/django-polymorphic</a></td>
</tr></tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup>
<col class="label">
<col>
</colgroup>
<tbody valign="top"><tr>
<td class="label"><a class="fn-backref" href="posts/django-polymorphic-integration-with-django-filters/#id2">[2]</a></td>
<td><a class="reference external" href="https://github.com/carltongibson/django-filter">https://github.com/carltongibson/django-filter</a></td>
</tr></tbody>
</table>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/eurotrip-2016/" class="u-url">Eurotrip 2016</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Woile</span></p>
            <p class="dateline"><a href="posts/eurotrip-2016/" rel="bookmark"><time class="post-date published dt-published" datetime="2017-01-08T12:30:53-03:00" title="2017-01-08 12:30">2017-01-08 12:30</time></a></p>
                <p class="commentline">
        
    <a href="posts/eurotrip-2016/#disqus_thread" data-disqus-identifier="cache/posts/eurotrip-2016.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<div class="youtube-video align-center">
<iframe width="640" height="360" src="https://www.youtube.com/embed/I3UGBamgnQU?rel=0&amp;hd=1&amp;wmode=transparent"></iframe>
</div>
<p>Hi guys, from may to november 2016, I've been traveling around Europe with some friends. I wanted to share some insight about our trip.</p>
<p>First, I would like to start with some numbers:</p>
<p><strong>720 litres</strong> of beer were drunk (around 2 lt per day per person during 3 months on average)</p>
<p>41 cities, <strong>13 countries</strong> visited.</p>
<p>12 airplanes, 10 buses, 6 trains, 2 ferries.</p>
<p>5 different seas, 1 ocean</p>
<p>Countles hours of sun</p>
<p>Cheapest country: <strong>Hungary</strong></p>
<p>Most expensive: <strong>London</strong></p>
<p>Best activity: <strong>Surf</strong> (Don't miss it if you have the opportunity)</p>
<iframe src="https://www.google.com/maps/d/embed?mid=1vkZK3ktJAtiDy2LnK_-Yzxq928E" width="640" height="480"></iframe><div class="section" id="friends">
<h2>Friends</h2>
<p>We met a lot of people, never had a problem with anyone, all of them were wonderful, except maybe a racist drunk swedish in Denmark, that was weird, but he didn't do anything to us, just complaining about random stuff.</p>
<p>If I had to make a recommendation, I'd say go to hostels in Spain and Portugal, because there you'll find the most relaxed environment and people willing to join you in an adventure. And please give an opportunity to couchsurfing, we didn't use it much, till the end, and we had a great experience, really warm people.</p>
</div>
<div class="section" id="money">
<h2>Money</h2>
<p>If you are wondering how much we spent, we used an easy rule. We calculated an average of USD 50 per day. Yes, that includes transportation (planes, buses, trains, etc), food and shelter.</p>
<p>How does this work? Well it's easy. First of all, housing is usually around USD 20, probably you'll find some places around USD 10 and sometimes USD 40, but, and let me focus on this word, the AVERAGE was USD 20.</p>
<p>Second, food. Let's be generous, and set USD 10 for food, which is a lot if you cook your own meals.</p>
<p>So, let's use 15 USD for transportation, but we are not going to be moving everyday, so you can sum it.
Doing some math, we were abroad for 90 days, with 15 USD for transportation every day, it's USD 1350 available to move, without taking into account the continental flights, it's around USD 52 per transport.</p>
<p>What do we do with the USD 5 left? Well it's USD 450 to spend in museums and going out, use it wisely.</p>
</div>
<div class="section" id="exploring-cities">
<h2>Exploring cities</h2>
<p>Okay, we didn't had much money to pay expensive tours, so we usually went to the free tours. They are in every city, and you pay what you want, after the tour, and if you don't like it, just leave.</p>
<p>They usually spam their other payed tours, but the important thing is that you get to know some worthy places to visit, like the Hofbräuhaus München. And you learn some history of the place.</p>
<p>Another important source of information are the <a class="reference external" href="https://www.use-it.travel/home/">USE-IT maps</a>. which are made by locals (or that's what they say). They explain some traditions of the city, where to go, and where not to go. You can download them or check where to get them, and the best part is that... it's FREE.</p>
<img src="galleries/greece/glyfada/GOPR3079.JPG">
</div>
<div class="section" id="transportation-sources">
<h2>Transportation sources</h2>
<p><a class="reference external" href="https://www.blablacar.es/">Blablacar</a>.
It's for car pooling, someone is going somewhere, and, having some free seats, they are offered in this platform.</p>
<p><a class="reference external" href="posts/eurotrip-2016/www.goeuro.com">Goeuro</a>.
Includes many transportation systems, train, bus, plane, car pooling. We used mostly for buses.</p>
<p><a class="reference external" href="posts/eurotrip-2016/www.google.com/flights/">Google Flights</a>.
It's the best search engine for flights, allowing to track specific flights or dates.</p>
</div>
<div class="section" id="acommodation-sources">
<h2>Acommodation sources</h2>
<p><a class="reference external" href="https://www.airbnb.com.ar/">AirBnb</a>.
Renting appartments</p>
<p><a class="reference external" href="http://www.hostelworld.com/">HostelWorld</a>.
Renting beds in hostels</p>
<p><a class="reference external" href="https://www.couchsurfing.com/">Couchsurfing</a>.
Going for free to someone's place. We did it once in Milan and we had a great experience.</p>
</div>
<div class="section" id="bottom-line">
<h2>Bottom line</h2>
<p>I encourage you to don't miss the opportunity to travel and meet new friends, you won't regret at all.</p>
<p>Happy new year!</p>
<p>Santi</p>
</div>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/get-skype-working-on-debian-stretch-x64-with-gnome3/" class="u-url">Get Skype working on Debian Stretch x64 with GNOME3</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Woile</span></p>
            <p class="dateline"><a href="posts/get-skype-working-on-debian-stretch-x64-with-gnome3/" rel="bookmark"><time class="post-date published dt-published" datetime="2016-09-19T07:56:03-03:00" title="2016-09-19 07:56">2016-09-19 07:56</time></a></p>
                <p class="commentline">
        
    <a href="posts/get-skype-working-on-debian-stretch-x64-with-gnome3/#disqus_thread" data-disqus-identifier="cache/posts/get-skype-working-on-debian-stretch-x64-with-gnome3.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<blockquote>
<p>Note</p>
<p>This info is no longer relevant. Right now Skype has been rewritten using <a class="reference external" href="https://electron.atom.io/">electron</a> and installing it in a debian based system is no longer a problem.
Right now it doesn't support screensharing and some other features a normal person would expect.</p>
</blockquote>
<p>Some alternatives I recommend:</p>
<ul class="simple">
<li><a class="reference external" href="https://appear.in/">appear.in</a></li>
<li><a class="reference external" href="https://tox.chat/">tox</a></li>
<li><a class="reference external" href="https://hangouts.google.com/">hangouts</a></li>
<li><a class="reference external" href="https://discordapp.com/">discord</a></li>
</ul>
<p>If you really need to install this software, and you cannot use the alternatives, then this guide is for you.</p>
<p>I got tired of installing skype so many times looking all over the internet, so I'll leave here some easy steps to make it work in Debian Stretch with GNOME 3.21 (and may be some earlier versions). It's just that there is not enough information around.
Debian recommends to install the .deb package, but it usually does not work.</p>
<p>As you probably know, skype is a 32bit software, so we'll need to enable that in our repository manager. Next we'll install some dependencies and finally we'll get the file in the specified folder.</p>
<pre class="code bash"><a name="rest_code_507a67e1a73d4a4b90c088396d8d66a9-1"></a>sudo dpkg --add-architecture i386
<a name="rest_code_507a67e1a73d4a4b90c088396d8d66a9-2"></a>sudo apt-get install libxv1:i386 libqtdbus4:i386 libqtwebkit4:i386 libxss1:i386
<a name="rest_code_507a67e1a73d4a4b90c088396d8d66a9-3"></a>mkdir ~/.apps/
<a name="rest_code_507a67e1a73d4a4b90c088396d8d66a9-4"></a>wget -qO- https://download.skype.com/linux/skype-4.3.0.37.tar.bz2 <span class="p">|</span> tar jx -C ~/.apps/
</pre>
<p>Instead of launching the <code>./skype</code> script, you can add a <code>skype.desktop</code> file to your gnome environment.</p>
<p>The location for this file is either <code>~/.local/share/applications</code>, for the current user, or <code>/usr/share/applications</code> for everyone.</p>
<p>The content for your <code>skype.desktop</code>, should be something like this:</p>
<pre class="code bash"><a name="rest_code_1bb742da052b49e38e95fe091015a262-1"></a><span class="o">[</span>Desktop Entry<span class="o">]</span>
<a name="rest_code_1bb742da052b49e38e95fe091015a262-2"></a><span class="nv">Name</span><span class="o">=</span>Skype
<a name="rest_code_1bb742da052b49e38e95fe091015a262-3"></a><span class="nv">Comment</span><span class="o">=</span>Skype Internet Telephony
<a name="rest_code_1bb742da052b49e38e95fe091015a262-4"></a><span class="nv">Exec</span><span class="o">=</span>/home/**santiago**/.apps/skype-4.3.0.37/skype
<a name="rest_code_1bb742da052b49e38e95fe091015a262-5"></a><span class="nv">Icon</span><span class="o">=</span>/home/**santiago**/.apps/skype-4.3.0.37/icons/SkypeBlue_96x96.png
<a name="rest_code_1bb742da052b49e38e95fe091015a262-6"></a><span class="nv">Terminal</span><span class="o">=</span><span class="nb">false</span>
<a name="rest_code_1bb742da052b49e38e95fe091015a262-7"></a><span class="nv">Type</span><span class="o">=</span>Application
<a name="rest_code_1bb742da052b49e38e95fe091015a262-8"></a><span class="nv">Encoding</span><span class="o">=</span>UTF-8
<a name="rest_code_1bb742da052b49e38e95fe091015a262-9"></a><span class="nv">Categories</span><span class="o">=</span>Network<span class="p">;</span>Application<span class="p">;</span>
<a name="rest_code_1bb742da052b49e38e95fe091015a262-10"></a><span class="nv">MimeType</span><span class="o">=</span>x-scheme-handler/skype<span class="p">;</span>
<a name="rest_code_1bb742da052b49e38e95fe091015a262-11"></a>X-KDE-Protocols<span class="o">=</span>skype
<a name="rest_code_1bb742da052b49e38e95fe091015a262-12"></a>X-GNOME-Bugzilla-Product<span class="o">=</span>skype
</pre>
<p>PS: Remember to change the user for the one you are using.</p>
<p>Good luck!</p>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/blog-inauguration/" class="u-url">Blog inauguration</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Woile</span></p>
            <p class="dateline"><a href="posts/blog-inauguration/" rel="bookmark"><time class="post-date published dt-published" datetime="2016-05-18T01:01:40-03:00" title="2016-05-18 01:01">2016-05-18 01:01</time></a></p>
                <p class="commentline">
        
    <a href="posts/blog-inauguration/#disqus_thread" data-disqus-identifier="cache/posts/blog-inauguration.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>I've decided to create this blog to share trip experiences,
software development, stuff interesting to me, and whatever I want.</p>
    </div>
    </article>
</div>



        
       <script>var disqus_shortname="woile";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2017         <a href="mailto:santiwilly@gmail.com">Woile</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77945905-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
